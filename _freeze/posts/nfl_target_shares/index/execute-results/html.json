{
  "hash": "0c8889700548d6f82095598c26418c74",
  "result": {
    "markdown": "---\ntitle: \"Untitled\"\nformat: html\n---\n\n# NFL Target Shares\n\n``` {.python .cell-code}\nimport requests\nimport pandas as pd\nfrom bs4 import BeautifulSoup as BS\n```\n\n\n``` {.python .cell-code}\ndef yearly_stats(season=2020):\n    \n    BASE_URL = f\"https://www.pro-football-reference.com/years/{season}/fantasy.htm\"\n\n    res = requests.get(BASE_URL)\n\n    soup = BS(res.content, 'html.parser')\n\n    table = soup.find('table', {'id': 'fantasy'})\n\n    df = pd.read_html(str(table))[0]\n\n    df.columns = df.columns.droplevel(level=0)\n\n    df['PassingTD'] = df['TD'].iloc[:, 0]\n    df['PassingYds'] = df['Yds'].iloc[:, 0]\n    df['RushingTD'] = df['Yds'].iloc[:, 1]\n    df['RushingYds'] = df['Yds'].iloc[:, 1]\n    df['ReceivingTD'] = df['TD'].iloc[:, 2]\n    df['ReceivingYds'] = df['Yds'].iloc[:, 2]\n\n    df['PassingAtt'] = df['Att'].iloc[:, 0]\n    df['RushingAtt'] = df['Att'].iloc[:, 1]\n\n    df = df.rename({\n        'FantPos': 'Pos'\n    }, axis=1)\n\n    df = df[['Player', 'Tm', 'Pos', 'Age', 'PassingAtt', 'Cmp', 'PassingYds', 'PassingTD', 'RushingAtt', 'RushingYds', 'RushingTD', 'Tgt', 'Rec', 'ReceivingYds', 'ReceivingTD', 'FL', '2PM']]\n\n    df = df.fillna(0)\n\n    df = df.loc[df['Player'] != 'Player'] \n\n    for column in df.columns[4:]:\n        df[column] = df[column].astype(int)\n\n    return df\n```\n\n\n``` {.python .cell-code}\ndef get_top_target_share(df, pos='WR', min_receptions=0, n=100):\n    df = df.merge(df.groupby('Tm')['Tgt'].sum(), how='left', on='Tm', suffixes=('_ind', '_team'))\n    df['Tgt_share'] = df['Tgt_ind'] / df['Tgt_team']\n    df = df.loc[(df['Pos'] == pos) & (df['Rec'] >= min_receptions)]\n    df = df.sort_values(by='Tgt_share', ascending=False)\n    df['Tgt_share_rank'] = df['Tgt_share'].rank(ascending=False, method='min')\n\n    with pd.option_context('display.max_rows', None):\n      df = df[['Player', 'Tm', 'Tgt_ind', 'Rec', 'Tgt_share', 'Tgt_share_rank']]\n      display(df.head(n))\n```\n\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\ndf = yearly_stats(2020)\nget_top_target_share(df, pos='WR', min_receptions=3, n=10)\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Player</th>\n      <th>Tm</th>\n      <th>Tgt_ind</th>\n      <th>Rec</th>\n      <th>Tgt_share</th>\n      <th>Tgt_share_rank</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>3</th>\n      <td>Davante Adams*+</td>\n      <td>GNB</td>\n      <td>149</td>\n      <td>115</td>\n      <td>0.297405</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>31</th>\n      <td>DeAndre Hopkins*</td>\n      <td>ARI</td>\n      <td>160</td>\n      <td>115</td>\n      <td>0.294659</td>\n      <td>2.0</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>Stefon Diggs*+</td>\n      <td>BUF</td>\n      <td>166</td>\n      <td>127</td>\n      <td>0.290718</td>\n      <td>3.0</td>\n    </tr>\n    <tr>\n      <th>70</th>\n      <td>Robby Anderson</td>\n      <td>CAR</td>\n      <td>136</td>\n      <td>95</td>\n      <td>0.258065</td>\n      <td>4.0</td>\n    </tr>\n    <tr>\n      <th>23</th>\n      <td>Justin Jefferson*</td>\n      <td>MIN</td>\n      <td>125</td>\n      <td>88</td>\n      <td>0.257732</td>\n      <td>5.0</td>\n    </tr>\n    <tr>\n      <th>103</th>\n      <td>Marquise Brown</td>\n      <td>BAL</td>\n      <td>100</td>\n      <td>58</td>\n      <td>0.257732</td>\n      <td>5.0</td>\n    </tr>\n    <tr>\n      <th>37</th>\n      <td>Allen Robinson</td>\n      <td>CHI</td>\n      <td>151</td>\n      <td>102</td>\n      <td>0.253782</td>\n      <td>7.0</td>\n    </tr>\n    <tr>\n      <th>49</th>\n      <td>Keenan Allen*</td>\n      <td>LAC</td>\n      <td>147</td>\n      <td>100</td>\n      <td>0.251712</td>\n      <td>8.0</td>\n    </tr>\n    <tr>\n      <th>33</th>\n      <td>Tyler Lockett</td>\n      <td>SEA</td>\n      <td>132</td>\n      <td>100</td>\n      <td>0.245810</td>\n      <td>9.0</td>\n    </tr>\n    <tr>\n      <th>20</th>\n      <td>D.K. Metcalf*</td>\n      <td>SEA</td>\n      <td>129</td>\n      <td>83</td>\n      <td>0.240223</td>\n      <td>10.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\nget_top_target_share(df, pos='RB', min_receptions=3, n=10)\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Player</th>\n      <th>Tm</th>\n      <th>Tgt_ind</th>\n      <th>Rec</th>\n      <th>Tgt_share</th>\n      <th>Tgt_share_rank</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>192</th>\n      <td>Kalen Ballage</td>\n      <td>2TM</td>\n      <td>37</td>\n      <td>29</td>\n      <td>0.229814</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>Alvin Kamara*</td>\n      <td>NOR</td>\n      <td>107</td>\n      <td>83</td>\n      <td>0.210630</td>\n      <td>2.0</td>\n    </tr>\n    <tr>\n      <th>119</th>\n      <td>J.D. McKissic</td>\n      <td>WAS</td>\n      <td>110</td>\n      <td>80</td>\n      <td>0.191972</td>\n      <td>3.0</td>\n    </tr>\n    <tr>\n      <th>190</th>\n      <td>James White</td>\n      <td>NWE</td>\n      <td>62</td>\n      <td>49</td>\n      <td>0.147971</td>\n      <td>4.0</td>\n    </tr>\n    <tr>\n      <th>77</th>\n      <td>Nyheim Hines</td>\n      <td>IND</td>\n      <td>76</td>\n      <td>63</td>\n      <td>0.142056</td>\n      <td>5.0</td>\n    </tr>\n    <tr>\n      <th>53</th>\n      <td>Mike Davis</td>\n      <td>CAR</td>\n      <td>70</td>\n      <td>59</td>\n      <td>0.132827</td>\n      <td>6.0</td>\n    </tr>\n    <tr>\n      <th>243</th>\n      <td>Ty Johnson</td>\n      <td>2TM</td>\n      <td>21</td>\n      <td>16</td>\n      <td>0.130435</td>\n      <td>7.0</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>Aaron Jones*</td>\n      <td>GNB</td>\n      <td>63</td>\n      <td>47</td>\n      <td>0.125749</td>\n      <td>8.0</td>\n    </tr>\n    <tr>\n      <th>209</th>\n      <td>Le'Veon Bell</td>\n      <td>2TM</td>\n      <td>20</td>\n      <td>16</td>\n      <td>0.124224</td>\n      <td>9.0</td>\n    </tr>\n    <tr>\n      <th>110</th>\n      <td>Chase Edmonds</td>\n      <td>ARI</td>\n      <td>67</td>\n      <td>53</td>\n      <td>0.123389</td>\n      <td>10.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\nget_top_target_share(df, pos='TE', min_receptions=3, n=10)\n```\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Player</th>\n      <th>Tm</th>\n      <th>Tgt_ind</th>\n      <th>Rec</th>\n      <th>Tgt_share</th>\n      <th>Tgt_share_rank</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>13</th>\n      <td>Darren Waller*</td>\n      <td>LVR</td>\n      <td>145</td>\n      <td>107</td>\n      <td>0.277247</td>\n      <td>1.0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>Travis Kelce*+</td>\n      <td>KAN</td>\n      <td>145</td>\n      <td>105</td>\n      <td>0.245347</td>\n      <td>2.0</td>\n    </tr>\n    <tr>\n      <th>45</th>\n      <td>Mark Andrews</td>\n      <td>BAL</td>\n      <td>88</td>\n      <td>58</td>\n      <td>0.226804</td>\n      <td>3.0</td>\n    </tr>\n    <tr>\n      <th>165</th>\n      <td>Evan Engram*</td>\n      <td>NYG</td>\n      <td>109</td>\n      <td>63</td>\n      <td>0.220648</td>\n      <td>4.0</td>\n    </tr>\n    <tr>\n      <th>51</th>\n      <td>T.J. Hockenson*</td>\n      <td>DET</td>\n      <td>101</td>\n      <td>67</td>\n      <td>0.200000</td>\n      <td>5.0</td>\n    </tr>\n    <tr>\n      <th>56</th>\n      <td>Logan Thomas</td>\n      <td>WAS</td>\n      <td>110</td>\n      <td>72</td>\n      <td>0.191972</td>\n      <td>6.0</td>\n    </tr>\n    <tr>\n      <th>148</th>\n      <td>Noah Fant</td>\n      <td>DEN</td>\n      <td>93</td>\n      <td>62</td>\n      <td>0.174484</td>\n      <td>7.0</td>\n    </tr>\n    <tr>\n      <th>153</th>\n      <td>Hunter Henry</td>\n      <td>LAC</td>\n      <td>93</td>\n      <td>60</td>\n      <td>0.159247</td>\n      <td>8.0</td>\n    </tr>\n    <tr>\n      <th>55</th>\n      <td>Mike Gesicki</td>\n      <td>MIA</td>\n      <td>85</td>\n      <td>53</td>\n      <td>0.158287</td>\n      <td>9.0</td>\n    </tr>\n    <tr>\n      <th>188</th>\n      <td>Austin Hooper</td>\n      <td>CLE</td>\n      <td>70</td>\n      <td>46</td>\n      <td>0.151188</td>\n      <td>10.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}